# Magic Rust Discord Bot

## Установка зависимостей
```shell
poetry install
```
Затем пишем: `poetry shell`  
Получаем путь нашего интерпретатора, затем его можно указать в 
IDE, чтобы проект адекватно работал.

## Настройка бота
- ".env.example" скопировать в ".env" и заполнить переменные
- В Discord Developer Portal:
    - Включить во вкладке Bot поле MESSAGE CONTENT INTENT
    - Сгенерировать ссылку на приглашение с правами администратора во вкладке OAuth2

## Запуск
Бот разделен на несколько приложений, по дефолту будут запущены все сразу.  
Для запуска нужны приложений нужно в ".env" файле изменить параметр SETUP_APPS=["app1", "app2].
Либо можно python -m bot app1 app2.  
Приоритет: аргументы в консоли, переменные окружения. 
Список доступных приложений можно увидеть в bot/apps.     
Запуск вспомогательных сервисов:
```shell
make up
```

Для запуска бота:
```shell
python -m bot
```

## Функционал

### Настройка бота
В любом канале можно выполнить команду из раздела `/settings ...` для настройки параметров и каналов бота.
Команда `/settings locale_roles` устанавливет связь роли с языком.

### Отложенные сообщения
`/m send` повзоляет отправить отложенное сообщение но только нахуй с картинкой, без неё нельзя.
`/queue show` - посмотреть очередь отложенных сообщений
`/queue clear` - очистить очередь отложенных сообщений

### Поиск друга
После установки каналов для поиска друга с помощью `/settings find_friends channels` в выбранном канале будут появляться запросы на поиск друга. В предыдущем предложении я напиздел.
Отправить запрос пользователь может командой `/friend`.
Повторно отправить запрос можно через время, задающееся командой `/settings find_friends cooldown`.

### Обслуживание постов (servicing_posts)
Позволяет автоматически обслуживать посты в выбранных каналах.  
Можно добавить возможность:
- Добавление лайка
- Добавления дизлайка
- Добавления комментариев
- Можно добавить игнорирование сообщений от бота, т.е. ему не будут ставиться выше выбранные параметры. 
- Можно добавить удаление сообщение в выбранном канале от всех ботов

Доступные команды для добавления, редактирования и удаление находятся в группе команд:  
`servicing-posts`  
Права доступа: Администратор

### Жалобы
...

### Голосовые каналы
Для того, чтобы пользователи могли создавать собственные голосовые каналы, с помощью подключения к мастер-каналу, нужно:
- Установить категорию для каждого языка, в которой будут создаваться голосовые каналы, с помощью `/settings voice_channels categories`
- Установить для каждого языка мастер-канал с помощью `/settings voice_channels master_channels`
Повторно создать канал можно через время, задающееся командой `/settings voice_channels cooldown`.

### Статус серверов
Отображает и обновляет картинку с загруженностью серверов. Под ней можно подобрать нужный сервер по фильтру.
`/settings server_status_channels` - текстовые каналы со статусом серверов для каждого языка
Изображение обновляется раз в минуту.

## Линтеры
В проекте есть линтеры, которые стилизует одинаково код.  
Для запуска: `pre-commit run --all-files` либо `make lint`